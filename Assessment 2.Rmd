---
title: "Assessment 2"
author: "Joanne Elizalde-Hernandez"
date: "01/09/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(skimr)
library(janitor)

data <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018/2018-11-20/thanksgiving_meals.csv")
```
## *Joanne Elizalde-Hernandez*  **s3886091**

# "Assignment 2"

### 1. Display the first 10 rows of the dataset using `kable()` function (1 marks). 

```{r}
knitr::kable(data[1:10, 1:10], "simple")
```

### 2. Using `skim()` display the summary of variables. 

```{r}
skim(data)
```
### Think about the task to predict a family income based on their menu: what variables may be useful? Are all of them correct type? 
Variables taken from the **thanksgiving_meals.csv** data set that would be useful to predict a family income based on their thanksgiving menu would be:
1. us_region
2. family_income
3. main_dish
4. age
5. community_type
6. celebrate = "Yes"

These variables contain the least missing values and would provide a truer representation of the data.  However not all the variables are the correct types and there is a character vectors that contain strings that needs to be converted to numeric representation to be able to plot. Some other variables also contain unorganized text that need to be converted to categorical variables.

### Think about the task to predict a community type or US_region based on their menu: what variables may be useful? Are all of them correct type? (2 marks)





### 3. Use `fct_reorder` and `parse_number` functions to create a factor variable `family_income`(2 mark).

```{r}
data %>% mutate(family_income=fct_reorder(family_income, parse_number(family_income)))
```

### 4. What is the number of people who celebrate? (1 mark)
980 people celebrate

```{r}
data%>%
  filter(celebrate== "Yes")

data %>% tabyl(celebrate)
```

### 5. What are categories and insights for each main dish served and the method it is prepared? (2 marks)
**Turkey** is the most popular main dish served at thanksgiving with a total of *859* people serving the main dish. Main preparation type for Turkey is *Baked* - 422, and *Roasted* - 351 and *Other* - 86.

```{r}
data %>% group_by(main_dish) %>% count('main_dish')

data %>% tabyl(main_dish, main_prep)


```

### 6. Create 3 different data viz showing insights for main dish served and the method. Provide your own legend and use themes.
Write 2-3 sentences with your explanation of each insight. (4 marks)

```{r}
#Data vis 1
data %>% 
  group_by(main_dish) %>% 
  count('main_prep', 'main_dish') %>% 
  ggplot(aes(main_prep, y=n, fill = main_prep))+
  geom_col()+
  geom_text(aes(label = n))+
   coord_flip()+
  facet_wrap(~main_dish)+
  theme_light()+
  ggtitle("Preperation type for Main dishes")


#data vis 2
Main_dishes <- data %>% 
  group_by(main_dish) %>% 
  count('main_prep') 

Main_dishes%>% 
  ggplot(aes('main_dish',y=n, colour=main_prep))+
  geom_jitter()+
  coord_flip()





```
```{r}
#data vis3
Main_dishes %>% group_by("Chicken") %>% count(main_prep)



```
### 7. How many use cranberry sauce? How many use gravy? 2marks

```{r}
#How many use cranberry.
data %>% count('cranberry')

data %>% tabyl(cranberry)

Cranberry <- data %>% filter(!is.na(cranberry)) %>% group_by(cranberry) %>% count()

#How many use gravy.
data %>% count(~gravy == "Yes")

data%>%
  filter(gravy== "Yes")


```

### 8. What is the distribution of those who celebrate across income ranges. Create a data viz.
Write 2-3 sentences with your explanation of each insight. (4 marks)
Families within the income bracket *$25,000 to $49,999*, who celebrate thanksgiving made up the largest group that celebrated the event.  Followed closely by familes within the incomes *$50,000 to $74,999* and *$75,000 to $99,999*.
Families who income brackets sat at *$150,000 to $174,999* or *$175,000 to $199,999*  were less likely than all other categories to celebrate thanksgiving.

```{r}
Celebrate <- data %>% 
  filter(celebrate == "Yes")

Celebrate %>% tabyl(family_income)

Celebrate %>% 
  filter(!is.na(family_income)) %>% 
  filter(!is.na(us_region)) %>% 
  ggplot(aes(family_income, celebrate == "Yes", fill= us_region))+
  geom_col()+
  coord_flip()+
  labs(title = "Distribution of those who celebrate across income ranges", x = "Family Income bracket", y = "Count of People who Celebrate Thanksgiving")
 

```
### 10. Use the following code to create a new data set 2 mark. Write 2-3 sentences with your explanation of what it does. (4 marks)

By creating a new data set with the **select** function, we are able to easily to refer to variables based on their names. The **starts_with** function matches variables according to a given pattern that starts with a defined prefix.  Therefore the new data set created enables us to easily see the type of sides, pies and dessert that are consumed at thanksgiving.

```{r}
data %>% select(id, starts_with("side"),
         starts_with("pie"),
         starts_with("dessert")) %>%
  select(-side15, -pie13, -dessert12) %>%
  gather(type, value, -id) %>%
  filter(!is.na(value),
         !value %in% c("None", "Other (please specify)")) %>%
  mutate(type = str_remove(type, "\\d+"))


Sides <- data %>% select(id, starts_with("side"),
         starts_with("pie"),
         starts_with("dessert")) %>%
  select(-side15, -pie13, -dessert12) %>%
  gather(type, value, -id) %>%
  filter(!is.na(value),
         !value %in% c("None", "Other (please specify)")) %>%
  mutate(type = str_remove(type, "\\d+"))

skim(Sides)

Sides %>% group_by(value) %>% 
  ggplot(aes(value,type, fill=type))+geom_col()+coord_flip()
```
### 11. Intall package `widyr` and use `pairwise_cor()` function https://www.rdocumentation.org/packages/widyr/versions/0.1.3/topics/pairwise_cor. Write 2-3 sentences with your explanation of what it does. (2 marks)

The function *pairwise_cor* finds correlations of pairs of items in a column, based on a "feature" column that links them together. 

```{r}
#install.packages('widyr')
library(widyr)

data %>% pairwise_cor(main_dish, main_dish_other)

```
### 13. Use `lm()` or randomForest() function to build a model that predict a family income based on data in the dataset. 8 marks13. Use `lm()` or randomForest() function to build a model that predict a family income based on data in the dataset. 8 marks


```{r}
library(randomForest)

data2<- data %>% 
  mutate(family_income_num=parse_number(family_income)) %>% 
  filter(!is.na(family_income_num))

summary(data2)

randomForest(family_income_num~celebrate+main_dish+age, data = data2, na.action = na.omit)


```

